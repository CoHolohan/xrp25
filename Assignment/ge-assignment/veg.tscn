[gd_scene load_steps=2 format=3 uid="uid://c0pr50dqydv21"]

[sub_resource type="GDScript" id="GDScript_qiill"]
script/source = "# veg.gd
extends RigidBody3D

@export var half_scene: PackedScene
@export var cut_impulse: float = 5.0

func slice(sword_transform: Transform3D) -> void:
	if half_scene == null:
		queue_free()
		return

	var world := get_tree().current_scene
	var cut_dir: Vector3 = sword_transform.basis.x.normalized()
	# (You can use x/z depending on how your katana is oriented)

	var pos := global_transform.origin

	# Remove the original veg
	queue_free()

	# Spawn 2 halves
	var half_a: RigidBody3D = half_scene.instantiate()
	var half_b: RigidBody3D = half_scene.instantiate()

	world.add_child(half_a)
	world.add_child(half_b)

	# Slight offset so the halves don't overlap
	var offset := cut_dir * 0.1
	half_a.global_transform.origin = pos + offset
	half_b.global_transform.origin = pos - offset

	# Give them a little \"pop\" apart + some upward force
	half_a.apply_impulse(cut_dir * cut_impulse + Vector3(0, 1.0, 0), Vector3.ZERO)
	half_b.apply_impulse(-cut_dir * cut_impulse + Vector3(0, 1.0, 0), Vector3.ZERO)

	# Optional: tag halves for scoring
	half_a.add_to_group(\"veghalf\")
	half_b.add_to_group(\"veghalf\")
"

[node name="Veg" type="RigidBody3D"]
script = SubResource("GDScript_qiill")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
